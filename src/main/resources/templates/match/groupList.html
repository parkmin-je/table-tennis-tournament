<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title th:text="${tournament.title} + ' - ì¡°í¸ì„±'">ì¡° í¸ì„±</title>
    <th:block layout:fragment="css">
    <style>
        .group-hero {
            background: linear-gradient(135deg, #1e3a5f 0%, #0d1b2a 100%);
            color: #fff; padding: 2.5rem 0 2rem;
            margin-bottom: 2.5rem; border-radius: 0 0 24px 24px;
            position: relative; overflow: hidden;
        }
        .group-hero::before {
            content: 'ğŸ“'; font-size: 8rem; position: absolute;
            right: 5%; top: 50%; transform: translateY(-50%); opacity: 0.06;
        }
        .group-hero .breadcrumb { opacity: 0.6; font-size: 0.82rem; }
        .group-hero .breadcrumb-item + .breadcrumb-item::before { color: rgba(255,255,255,0.4); }
        .group-hero h1 { font-size: 1.8rem; font-weight: 900; }
        .tournament-badge {
            display: inline-flex; align-items: center; gap: 6px;
            background: rgba(255,165,0,0.2); border: 1px solid rgba(255,165,0,0.4);
            border-radius: 50px; padding: 5px 14px; font-size: 0.82rem; color: #fcd34d;
            margin-top: 0.5rem;
        }

        .bracket-wrapper {
            background: var(--bg-white); border-radius: 16px;
            box-shadow: var(--shadow-md); overflow: hidden;
        }
        .bracket-header {
            background: linear-gradient(135deg, #1e3a5f, #0d1b2a);
            color: #fff; padding: 1rem 1.5rem;
            display: flex; align-items: center; justify-content: space-between;
        }
        .bracket-header h5 { margin: 0; font-weight: 700; }
        .bracket-body { padding: 2rem; min-height: 300px; }

        /* Loading spinner */
        .bracket-loading {
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; min-height: 200px; gap: 1rem;
            color: var(--text-secondary);
        }
        .spinner-ring {
            width: 48px; height: 48px;
            border: 4px solid var(--border-color);
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .btn-back-detail {
            display: inline-flex; align-items: center; gap: 6px;
            background: var(--bg-white); color: var(--text-secondary);
            border: 1.5px solid var(--border-color); border-radius: 8px;
            padding: 8px 18px; font-size: 0.88rem; font-weight: 600;
            text-decoration: none; transition: all 0.2s;
        }
        .btn-back-detail:hover { border-color: #6b7280; color: var(--text-primary); }
    </style>
    </th:block>
</head>
<body>
<div layout:fragment="content">

    <!-- Hero -->
    <div class="group-hero">
        <div class="container">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-2">
                    <li class="breadcrumb-item"><a href="/tournament/list" class="text-white-50">ëŒ€íšŒ</a></li>
                    <li class="breadcrumb-item">
                        <a th:href="@{|/tournament/detail/${tournament.id}|}" class="text-white-50"
                           th:text="${tournament.title}">ëŒ€íšŒëª…</a>
                    </li>
                    <li class="breadcrumb-item active text-white">ì¡° í¸ì„±</li>
                </ol>
            </nav>
            <h1><i class="bi bi-diagram-3-fill me-3"></i>ì˜ˆì„  ì¡° í¸ì„±</h1>
            <div class="tournament-badge">
                <i class="bi bi-trophy-fill"></i>
                <span th:text="${tournament.title}">ëŒ€íšŒëª…</span>
            </div>
        </div>
    </div>

    <div class="container pb-5">

        <!-- Bracket Container -->
        <div class="bracket-wrapper mb-4">
            <div class="bracket-header">
                <h5><i class="bi bi-grid-3x3-gap-fill me-2"></i>ì¡°ë³„ ëŒ€ì§„í‘œ</h5>
                <span class="badge bg-light text-dark" id="groupCount">ë¡œë”© ì¤‘...</span>
            </div>
            <div class="bracket-body">
                <div id="bracketContainer">
                    <div class="bracket-loading">
                        <div class="spinner-ring"></div>
                        <span>ì¡° í¸ì„± ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Back Button -->
        <a th:href="@{|/tournament/detail/${tournament.id}|}" class="btn-back-detail">
            <i class="bi bi-arrow-left"></i>ëŒ€íšŒ ìƒì„¸ë¡œ ëŒì•„ê°€ê¸°
        </a>
    </div>

    <th:block layout:fragment="script">
        <script th:src="@{/js/group-bracket.js}"></script>
        <script th:inline="javascript">
            /*<![CDATA[*/
            const tournamentId = /*[[${tournament.id}]]*/ 0;
            document.addEventListener('DOMContentLoaded', function() {
                if (typeof renderGroupBrackets === 'function') {
                    renderGroupBrackets(tournamentId, '#bracketContainer')
                        .then(count => {
                            document.getElementById('groupCount').textContent = count + 'ê°œ ì¡°';
                        })
                        .catch(() => {
                            document.getElementById('groupCount').textContent = 'ë¡œë“œ ì‹¤íŒ¨';
                        });
                }
            });
            /*]]>*/
        </script>
    </th:block>
</div>
</body>
</html>
