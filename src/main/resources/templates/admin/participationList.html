<!DOCTYPE html>
<html layout:decorate="~{layout}" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>참가 신청 관리</title>
    <th:block layout:fragment="css">
    <style>
        .admin-hero {
            background: linear-gradient(135deg, #0d1b2a 0%, #1a2e44 100%);
            color: #fff; padding: 2.5rem 0 2rem;
            margin-bottom: 2rem; border-radius: 0 0 20px 20px;
        }
        .admin-hero h1 { font-size: 1.8rem; font-weight: 800; letter-spacing: -0.5px; }
        .admin-hero .breadcrumb { opacity: 0.6; font-size: 0.85rem; }
        .admin-hero .breadcrumb-item + .breadcrumb-item::before { color: rgba(255,255,255,0.4); }
        .stat-pill {
            display: inline-flex; align-items: center; gap: 6px;
            background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15);
            border-radius: 50px; padding: 6px 16px; font-size: 0.82rem;
        }
        .stat-pill .count { font-weight: 700; font-size: 1rem; }
        .admin-card { background: var(--bg-white); border-radius: 14px; box-shadow: var(--shadow-md); overflow: hidden; }
        .admin-card-header {
            background: linear-gradient(135deg, #1e3a5f 0%, #0d1b2a 100%);
            color: #fff; padding: 1rem 1.5rem;
            display: flex; align-items: center; justify-content: space-between;
        }
        .admin-card-header h5 { margin: 0; font-weight: 700; font-size: 1rem; }
        .part-table { width: 100%; }
        .part-table th {
            background: #f8f9fa; color: #6b7280; font-size: 0.75rem;
            font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;
            padding: 12px 16px; border-bottom: 2px solid #e5e7eb;
        }
        .part-table td { padding: 12px 16px; font-size: 0.9rem; border-bottom: 1px solid #f3f4f6; vertical-align: middle; }
        .part-table tr:hover td { background: #f8faff; }
        .status-badge { display: inline-block; padding: 3px 10px; border-radius: 50px; font-size: 0.75rem; font-weight: 600; }
        .status-신청완료 { background: #dbeafe; color: #1d4ed8; }
        .status-입금대기 { background: #fef3c7; color: #b45309; }
        .status-입금완료 { background: #d1fae5; color: #065f46; }
        .status-취소 { background: #f3f4f6; color: #6b7280; }
        .status-승인완료 { background: #ede9fe; color: #7c3aed; }
        .status-select-mini {
            font-size: 0.8rem; padding: 4px 8px; border-radius: 8px;
            border: 1.5px solid #e5e7eb; min-width: 100px;
            background: #fff; cursor: pointer; transition: border-color 0.2s;
        }
        .status-select-mini:hover { border-color: #3b82f6; }
        .empty-state { text-align: center; padding: 60px 20px; color: #9ca3af; }
        .empty-state i { font-size: 3.5rem; margin-bottom: 1rem; display: block; }
        [data-theme="dark"] .part-table th { background: rgba(255,255,255,0.05); color: #9ca3af; border-color: rgba(255,255,255,0.08); }
        [data-theme="dark"] .part-table td { border-color: rgba(255,255,255,0.06); }
        [data-theme="dark"] .part-table tr:hover td { background: rgba(255,255,255,0.03); }
        [data-theme="dark"] .status-select-mini { background: #1e1e30; border-color: #333344; color: #f0f0f0; }
    </style>
    </th:block>
</head>
<body>
<div layout:fragment="content">
    <div class="admin-hero">
        <div class="container">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-2">
                    <li class="breadcrumb-item"><a href="/admin/dashboard" class="text-white-50">관리자</a></li>
                    <li class="breadcrumb-item active text-white">참가 신청 관리</li>
                </ol>
            </nav>
            <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
                <div>
                    <h1><i class="bi bi-person-check-fill me-3"></i>참가 신청 관리</h1>
                    <p class="mb-0 opacity-75 small">전체 대회 참가 신청 현황을 관리합니다</p>
                </div>
                <div class="d-flex flex-wrap gap-2">
                    <div class="stat-pill" th:each="entry : ${stats}">
                        <span class="count" th:text="${entry.value}">0</span>
                        <span th:text="${entry.key}">상태</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container pb-5">
        <div th:if="${message}"
             th:classappend="${alertType != null ? 'alert-' + alertType : 'alert-info'}"
             class="alert alert-dismissible fade show rounded-3 mb-4" role="alert">
            <span th:text="${message}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <div class="admin-card">
            <div class="admin-card-header">
                <h5><i class="bi bi-table me-2"></i>신청 목록</h5>
                <span class="badge bg-light text-dark" th:text="${#lists.size(participations)} + '건'">0건</span>
            </div>
            <div class="table-responsive">
                <table class="part-table">
                    <thead>
                    <tr>
                        <th>ID</th><th>대회명</th><th>참가자</th><th>팀명</th><th>신청일</th><th>상태</th><th>상태 변경</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:if="${#lists.isEmpty(participations)}">
                        <td colspan="7">
                            <div class="empty-state">
                                <i class="bi bi-inbox"></i>
                                <p class="fw-semibold">신청 내역이 없습니다</p>
                            </div>
                        </td>
                    </tr>
                    <tr th:each="p : ${participations}">
                        <td><span class="text-muted small">#<span th:text="${p.id}"></span></span></td>
                        <td>
                            <a th:href="@{|/tournament/detail/${p.tournament.id}|}"
                               th:text="${p.tournament.title}" class="fw-semibold text-decoration-none"></a>
                        </td>
                        <td>
                            <div class="d-flex align-items-center gap-2">
                                <div style="width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,#6366f1,#8b5cf6);display:flex;align-items:center;justify-content:center;color:#fff;font-size:0.8rem;font-weight:700;flex-shrink:0;"
                                     th:text="${p.user != null ? #strings.substring(p.user.name,0,1) : '?'}">U</div>
                                <div>
                                    <div class="fw-semibold small" th:text="${p.user != null ? p.user.name : '알 수 없음'}">이름</div>
                                    <div class="text-muted" style="font-size:0.75rem;" th:text="${p.user != null ? '@' + p.user.username : ''}">@id</div>
                                </div>
                            </div>
                        </td>
                        <td class="text-muted small" th:text="${p.teamName}">-</td>
                        <td class="text-muted small" th:text="${p.registeredAt != null ? #temporals.format(p.registeredAt, 'yy.MM.dd HH:mm') : '-'}">-</td>
                        <td>
                            <span th:class="'status-badge status-' + ${p.status}" th:text="${p.status}">상태</span>
                        </td>
                        <td>
                            <form th:action="@{/admin/updateStatus}" method="post">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                <input type="hidden" name="participationId" th:value="${p.id}">
                                <select name="newStatus" class="status-select-mini" onchange="this.form.submit()">
                                    <option value="신청완료" th:selected="${p.status == '신청완료'}">신청완료</option>
                                    <option value="입금대기" th:selected="${p.status == '입금대기'}">입금대기</option>
                                    <option value="입금완료" th:selected="${p.status == '입금완료'}">입금완료</option>
                                    <option value="승인완료" th:selected="${p.status == '승인완료'}">승인완료</option>
                                    <option value="취소" th:selected="${p.status == '취소'}">취소</option>
                                </select>
                            </form>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
</body>
</html>
