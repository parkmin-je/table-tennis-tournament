<!DOCTYPE html>
<html layout:decorate="~{layout}" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</title>
    <th:block layout:fragment="css">
        <style>
            .admin-hero {
                background: linear-gradient(135deg, #0a2540 0%, #1a3a6b 100%);
                color: white; padding: 2rem 0 3.5rem;
                margin-bottom: 2rem; position: relative; overflow: hidden;
            }
            .admin-hero::after {
                content: ''; position: absolute;
                bottom: -2px; left: 0; right: 0; height: 50px;
                background: var(--bg-light);
                clip-path: ellipse(55% 100% at 50% 100%);
            }

            /* í†µê³„ ì¹´ë“œ */
            .kpi-card {
                background: var(--bg-white);
                border-radius: 16px;
                padding: 1.5rem;
                border: 1px solid var(--border-color);
                box-shadow: var(--shadow-sm);
                display: flex; align-items: center; gap: 1.2rem;
                transition: all 0.25s ease;
                text-decoration: none; color: inherit;
            }
            .kpi-card:hover { transform: translateY(-4px); box-shadow: var(--shadow-md); color: inherit; }
            .kpi-icon {
                width: 60px; height: 60px; border-radius: 14px;
                display: flex; align-items: center; justify-content: center;
                font-size: 1.6rem; flex-shrink: 0;
            }
            .kpi-icon.purple  { background: linear-gradient(135deg, #7c3aed, #5b21b6); color: white; }
            .kpi-icon.rose    { background: linear-gradient(135deg, #e11d48, #be123c); color: white; }
            .kpi-icon.blue    { background: linear-gradient(135deg, #0284c7, #0369a1); color: white; }
            .kpi-icon.emerald { background: linear-gradient(135deg, #059669, #047857); color: white; }
            .kpi-num { font-size: 2rem; font-weight: 900; line-height: 1; color: var(--text-primary); }
            .kpi-label { font-size: 0.8rem; color: var(--text-secondary); font-weight: 600; margin-top: 0.2rem; }

            /* ì„¹ì…˜ ì¹´ë“œ */
            .dash-card {
                background: var(--bg-white);
                border-radius: 16px;
                border: 1px solid var(--border-color);
                box-shadow: var(--shadow-sm);
                overflow: hidden;
            }
            .dash-card-header {
                padding: 1rem 1.5rem;
                border-bottom: 1px solid var(--border-color);
                display: flex; align-items: center; justify-content: space-between;
            }
            .dash-card-title {
                font-size: 0.95rem; font-weight: 800;
                color: var(--text-primary);
                display: flex; align-items: center; gap: 0.5rem;
            }

            /* í…Œì´ë¸” */
            .dash-table { width: 100%; border-collapse: collapse; }
            .dash-table th {
                padding: 0.7rem 1.2rem;
                font-size: 0.72rem; font-weight: 700;
                text-transform: uppercase; letter-spacing: 0.05em;
                color: var(--text-secondary);
                border-bottom: 1px solid var(--border-color);
                background: var(--bg-light);
            }
            .dash-table td {
                padding: 0.85rem 1.2rem;
                font-size: 0.88rem; color: var(--text-primary);
                border-bottom: 1px solid var(--border-color);
            }
            .dash-table tr:last-child td { border-bottom: none; }
            .dash-table tr:hover td { background: var(--bg-light); }

            /* ìƒíƒœ ë±ƒì§€ */
            .status-pill {
                display: inline-flex; align-items: center; gap: 0.3rem;
                padding: 0.2rem 0.65rem; border-radius: 20px;
                font-size: 0.72rem; font-weight: 700;
            }
            .pill-recruiting { background: #d1fae5; color: #059669; }
            .pill-inprogress { background: #fff3cd; color: #d97706; }
            .pill-ready      { background: #e0e7ff; color: #4f46e5; }
            .pill-completed  { background: #f3f4f6; color: #6b7280; }
            .pill-applied    { background: #dbeafe; color: #2563eb; }
            .pill-approved   { background: #d1fae5; color: #059669; }
            .pill-paid       { background: #e0e7ff; color: #7c3aed; }

            /* ë¹ ë¥¸ ì•¡ì…˜ */
            .quick-action-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
                gap: 1rem;
            }
            .quick-action-btn {
                display: flex; flex-direction: column; align-items: center;
                gap: 0.6rem; padding: 1.2rem 1rem;
                background: var(--bg-white);
                border: 2px solid var(--border-color);
                border-radius: 14px;
                text-decoration: none; color: var(--text-primary);
                font-weight: 700; font-size: 0.85rem;
                text-align: center; transition: all 0.25s ease;
                box-shadow: var(--shadow-sm);
            }
            .quick-action-btn .action-icon {
                width: 48px; height: 48px; border-radius: 12px;
                display: flex; align-items: center; justify-content: center;
                font-size: 1.3rem; transition: transform 0.2s;
            }
            .quick-action-btn:hover {
                transform: translateY(-4px);
                box-shadow: var(--shadow-md);
                color: var(--text-primary);
            }
            .quick-action-btn:hover .action-icon { transform: scale(1.1); }
            .action-green  { background: linear-gradient(135deg, #22c55e, #16a34a); color: white; }
            .action-blue   { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; }
            .action-teal   { background: linear-gradient(135deg, #14b8a6, #0d9488); color: white; }
            .action-orange { background: linear-gradient(135deg, #f97316, #ea580c); color: white; }
            .action-purple { background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; }
            .action-red    { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; }

            /* ì°¨íŠ¸ ì˜ì—­ */
            .chart-container {
                position: relative; height: 220px;
                display: flex; align-items: center; justify-content: center;
            }

            /* í™œë™ í”¼ë“œ */
            .activity-item {
                display: flex; align-items: flex-start; gap: 0.8rem;
                padding: 0.85rem 1.2rem;
                border-bottom: 1px solid var(--border-color);
                font-size: 0.86rem;
            }
            .activity-item:last-child { border-bottom: none; }
            .activity-dot {
                width: 10px; height: 10px; border-radius: 50%;
                flex-shrink: 0; margin-top: 5px;
            }
            .dot-green  { background: #22c55e; }
            .dot-blue   { background: #3b82f6; }
            .dot-orange { background: #f97316; }
            .dot-gray   { background: #9ca3af; }
            .activity-time { font-size: 0.72rem; color: var(--text-secondary); white-space: nowrap; }

            /* ì˜¨ë¼ì¸ ì¸ë””ì¼€ì´í„° */
            .online-dot {
                width: 8px; height: 8px; border-radius: 50%;
                background: #22c55e; display: inline-block;
                animation: ping 1.5s infinite;
            }
            @keyframes ping {
                0%, 100% { box-shadow: 0 0 0 0 rgba(34,197,94,0.6); }
                50% { box-shadow: 0 0 0 6px rgba(34,197,94,0); }
            }
        </style>
    </th:block>
</head>
<body>
<div layout:fragment="content">

    <!-- íˆì–´ë¡œ -->
    <div class="admin-hero">
        <div class="container position-relative" style="z-index:1;">
            <div class="d-flex align-items-center gap-3 mb-1">
                <div style="width:44px; height:44px; background:rgba(255,255,255,0.15); border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:1.3rem;">
                    ğŸ›¡ï¸
                </div>
                <div>
                    <h1 class="fw-black mb-0" style="font-size:1.9rem; letter-spacing:-0.02em;">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
                    <p class="mb-0 opacity-70" style="font-size:0.85rem;">
                        <span class="online-dot me-1"></span>ì‹œìŠ¤í…œ ì •ìƒ ìš´ì˜ ì¤‘
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="container pb-5" style="margin-top: -1rem;">

        <!-- KPI ì¹´ë“œ -->
        <div class="row g-3 mb-4">
            <div class="col-6 col-md-3">
                <a th:href="@{/admin/tournaments}" class="kpi-card d-flex">
                    <div class="kpi-icon purple"><i class="bi bi-trophy-fill"></i></div>
                    <div>
                        <div class="kpi-num" th:text="${totalTournaments}">0</div>
                        <div class="kpi-label">ì „ì²´ ëŒ€íšŒ</div>
                    </div>
                </a>
            </div>
            <div class="col-6 col-md-3">
                <div class="kpi-card">
                    <div class="kpi-icon rose"><i class="bi bi-person-fill"></i></div>
                    <div>
                        <div class="kpi-num" th:text="${totalUsers}">0</div>
                        <div class="kpi-label">ì „ì²´ íšŒì›</div>
                    </div>
                </div>
            </div>
            <div class="col-6 col-md-3">
                <a th:href="@{/player/list}" class="kpi-card d-flex">
                    <div class="kpi-icon blue"><i class="bi bi-people-fill"></i></div>
                    <div>
                        <div class="kpi-num" th:text="${totalPlayers}">0</div>
                        <div class="kpi-label">ë“±ë¡ ì„ ìˆ˜</div>
                    </div>
                </a>
            </div>
            <div class="col-6 col-md-3">
                <div class="kpi-card">
                    <div class="kpi-icon emerald"><i class="bi bi-lightning-fill"></i></div>
                    <div>
                        <div class="kpi-num" th:text="${ongoingTournaments}">0</div>
                        <div class="kpi-label">ì§„í–‰ ì¤‘ ëŒ€íšŒ</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë¹ ë¥¸ ì•¡ì…˜ -->
        <div class="dash-card mb-4">
            <div class="dash-card-header">
                <div class="dash-card-title">
                    <i class="bi bi-lightning-charge" style="color:#f97316;"></i>ë¹ ë¥¸ ì‘ì—…
                </div>
            </div>
            <div class="p-4">
                <div class="quick-action-grid">
                    <a th:href="@{/tournament/create}" class="quick-action-btn">
                        <div class="action-icon action-green"><i class="bi bi-plus-circle-fill"></i></div>
                        ìƒˆ ëŒ€íšŒ ë“±ë¡
                    </a>
                    <a th:href="@{/player/create}" class="quick-action-btn">
                        <div class="action-icon action-blue"><i class="bi bi-person-plus-fill"></i></div>
                        ì„ ìˆ˜ ë“±ë¡
                    </a>
                    <a th:href="@{/club/create}" class="quick-action-btn">
                        <div class="action-icon action-teal"><i class="bi bi-building-add"></i></div>
                        í´ëŸ½ ë“±ë¡
                    </a>
                    <a th:href="@{/admin/participationList}" class="quick-action-btn">
                        <div class="action-icon action-orange"><i class="bi bi-clipboard-check-fill"></i></div>
                        ì°¸ê°€ ì‹ ì²­ ê´€ë¦¬
                    </a>
                    <a th:href="@{/player/ranking}" class="quick-action-btn">
                        <div class="action-icon action-purple"><i class="bi bi-bar-chart-line-fill"></i></div>
                        ë­í‚¹ ë³´ê¸°
                    </a>
                    <a th:href="@{/admin/tournaments}" class="quick-action-btn">
                        <div class="action-icon action-red"><i class="bi bi-gear-fill"></i></div>
                        ëŒ€íšŒ ê´€ë¦¬
                    </a>
                </div>
            </div>
        </div>

        <div class="row g-4">

            <!-- ìµœê·¼ ëŒ€íšŒ ëª©ë¡ -->
            <div class="col-lg-7">
                <div class="dash-card h-100">
                    <div class="dash-card-header">
                        <div class="dash-card-title">
                            <i class="bi bi-trophy" style="color:#7c3aed;"></i>ìµœê·¼ ëŒ€íšŒ
                        </div>
                        <a th:href="@{/admin/tournaments}" class="btn btn-sm btn-outline-primary fw-bold" style="font-size:0.78rem;">
                            ì „ì²´ ë³´ê¸°
                        </a>
                    </div>
                    <table class="dash-table">
                        <thead>
                        <tr>
                            <th>ëŒ€íšŒëª…</th>
                            <th>ìƒíƒœ</th>
                            <th>ìƒì„±ì¼</th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="t : ${recentTournaments}">
                            <td>
                                <a th:href="@{/tournament/detail/{id}(id=${t.id})}"
                                   class="fw-bold text-decoration-none"
                                   style="color:var(--text-primary);"
                                   th:text="${t.title}">ëŒ€íšŒëª…</a>
                            </td>
                            <td>
                                <span class="status-pill"
                                      th:classappend="${t.status.name() == 'RECRUITING' ? ' pill-recruiting' :
                                                       (t.status.name() == 'IN_PROGRESS' ? ' pill-inprogress' :
                                                       (t.status.name() == 'READY' ? ' pill-ready' : ' pill-completed'))}"
                                      th:text="${t.status.description}">ìƒíƒœ</span>
                            </td>
                            <td style="color:var(--text-secondary);"
                                th:text="${#temporals.format(t.createdAt, 'MM/dd')}">01/01</td>
                            <td>
                                <div class="d-flex gap-1">
                                    <a th:href="@{/tournament/detail/{id}(id=${t.id})}"
                                       class="btn btn-sm btn-outline-primary"
                                       style="padding:0.2rem 0.5rem; font-size:0.75rem;">
                                        <i class="bi bi-eye"></i>
                                    </a>
                                    <a th:href="@{/tournament/edit/{id}(id=${t.id})}"
                                       class="btn btn-sm btn-outline-warning"
                                       style="padding:0.2rem 0.5rem; font-size:0.75rem;">
                                        <i class="bi bi-pencil"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(recentTournaments)}">
                            <td colspan="4" class="text-center text-muted py-4">ë“±ë¡ëœ ëŒ€íšŒê°€ ì—†ìŠµë‹ˆë‹¤.</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ìµœê·¼ ì°¸ê°€ ì‹ ì²­ -->
            <div class="col-lg-5">
                <div class="dash-card h-100">
                    <div class="dash-card-header">
                        <div class="dash-card-title">
                            <i class="bi bi-person-check" style="color:#059669;"></i>ìµœê·¼ ì°¸ê°€ ì‹ ì²­
                        </div>
                        <a th:href="@{/admin/participationList}" class="btn btn-sm btn-outline-success fw-bold" style="font-size:0.78rem;">
                            ì „ì²´ ë³´ê¸°
                        </a>
                    </div>
                    <div>
                        <div class="activity-item" th:each="p : ${recentParticipations}">
                            <div class="activity-dot"
                                 th:classappend="${p.status == 'ìŠ¹ì¸ì™„ë£Œ' ? ' dot-green' :
                                                  (p.status == 'ì…ê¸ˆì™„ë£Œ' ? ' dot-blue' :
                                                  (p.status == 'ì‹ ì²­ì™„ë£Œ' ? ' dot-orange' : ' dot-gray'))}"></div>
                            <div class="flex-1" style="min-width:0;">
                                <div class="fw-bold" style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"
                                     th:text="${p.user != null ? p.user.name : 'ì•Œ ìˆ˜ ì—†ìŒ'}">ì‹ ì²­ì</div>
                                <div class="text-muted" style="font-size:0.78rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"
                                     th:text="${p.tournament.title}">ëŒ€íšŒëª…</div>
                            </div>
                            <div class="d-flex flex-column align-items-end gap-1">
                                <span class="status-pill"
                                      th:classappend="${p.status == 'ì‹ ì²­ì™„ë£Œ' ? ' pill-applied' :
                                                       (p.status == 'ìŠ¹ì¸ì™„ë£Œ' ? ' pill-approved' :
                                                       (p.status == 'ì…ê¸ˆì™„ë£Œ' ? ' pill-paid' : ' pill-completed'))}"
                                      th:text="${p.status}">ìƒíƒœ</span>
                                <span class="activity-time"
                                      th:text="${#temporals.format(p.registeredAt, 'MM/dd')}">01/01</span>
                            </div>
                        </div>
                        <div class="text-center text-muted py-4" th:if="${#lists.isEmpty(recentParticipations)}">
                            <i class="bi bi-person-x" style="font-size:2rem; opacity:0.3;"></i>
                            <p class="mt-2 mb-0 small">ìµœê·¼ ì°¸ê°€ ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                    </div>
                </div>
            </div>

        </div><!-- /row -->

        <!-- ì°¨íŠ¸ + ìƒíƒœ ìš”ì•½ -->
        <div class="row g-4 mt-1">
            <div class="col-md-5">
                <div class="dash-card">
                    <div class="dash-card-header">
                        <div class="dash-card-title">
                            <i class="bi bi-pie-chart" style="color:#0284c7;"></i>ëŒ€íšŒ í˜„í™©
                        </div>
                    </div>
                    <div class="p-4">
                        <div class="chart-container">
                            <canvas id="tournamentChart"></canvas>
                        </div>
                        <div class="d-flex flex-wrap justify-content-center gap-3 mt-2">
                            <div class="d-flex align-items-center gap-1" style="font-size:0.78rem;">
                                <span style="width:10px;height:10px;border-radius:2px;background:#7c3aed;display:inline-block;"></span>
                                ì¤€ë¹„ì¤‘
                            </div>
                            <div class="d-flex align-items-center gap-1" style="font-size:0.78rem;">
                                <span style="width:10px;height:10px;border-radius:2px;background:#22c55e;display:inline-block;"></span>
                                ì ‘ìˆ˜ì¤‘
                            </div>
                            <div class="d-flex align-items-center gap-1" style="font-size:0.78rem;">
                                <span style="width:10px;height:10px;border-radius:2px;background:#f97316;display:inline-block;"></span>
                                ì§„í–‰ì¤‘
                            </div>
                            <div class="d-flex align-items-center gap-1" style="font-size:0.78rem;">
                                <span style="width:10px;height:10px;border-radius:2px;background:#6b7280;display:inline-block;"></span>
                                ì¢…ë£Œ
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-7">
                <div class="dash-card h-100">
                    <div class="dash-card-header">
                        <div class="dash-card-title">
                            <i class="bi bi-speedometer2" style="color:#f97316;"></i>ì‹œìŠ¤í…œ í˜„í™©
                        </div>
                    </div>
                    <div class="p-4">
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-1" style="font-size:0.83rem;">
                                <span class="fw-bold">ëŒ€íšŒ í™œì„±í™”ìœ¨</span>
                                <span class="fw-bold" style="color:var(--primary-color);"
                                      th:text="${totalTournaments > 0 ? #numbers.formatDecimal(ongoingTournaments * 100.0 / totalTournaments, 0, 0) + '%' : '0%'}">0%</span>
                            </div>
                            <div style="height:8px; background:var(--bg-light); border-radius:4px; overflow:hidden;">
                                <div style="height:100%; border-radius:4px; background:var(--gradient-primary); transition:width 1s ease;"
                                     th:style="'width:' + (${totalTournaments > 0 ? ongoingTournaments * 100 / totalTournaments : 0}) + '%'"></div>
                            </div>
                        </div>
                        <div class="row g-3 mt-1">
                            <div class="col-6">
                                <div style="background:linear-gradient(135deg, rgba(124,58,237,0.1), rgba(91,33,182,0.05)); border:1px solid rgba(124,58,237,0.2); border-radius:12px; padding:1rem; text-align:center;">
                                    <div style="font-size:1.6rem; font-weight:900; color:#7c3aed;" th:text="${totalTournaments}">0</div>
                                    <div style="font-size:0.75rem; color:var(--text-secondary); font-weight:600;">ì „ì²´ ëŒ€íšŒ</div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div style="background:linear-gradient(135deg, rgba(34,197,94,0.1), rgba(22,163,74,0.05)); border:1px solid rgba(34,197,94,0.2); border-radius:12px; padding:1rem; text-align:center;">
                                    <div style="font-size:1.6rem; font-weight:900; color:#22c55e;" th:text="${ongoingTournaments}">0</div>
                                    <div style="font-size:0.75rem; color:var(--text-secondary); font-weight:600;">ì§„í–‰ ì¤‘</div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div style="background:linear-gradient(135deg, rgba(59,130,246,0.1), rgba(37,99,235,0.05)); border:1px solid rgba(59,130,246,0.2); border-radius:12px; padding:1rem; text-align:center;">
                                    <div style="font-size:1.6rem; font-weight:900; color:#3b82f6;" th:text="${totalPlayers}">0</div>
                                    <div style="font-size:0.75rem; color:var(--text-secondary); font-weight:600;">ë“±ë¡ ì„ ìˆ˜</div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div style="background:linear-gradient(135deg, rgba(225,29,72,0.1), rgba(190,18,60,0.05)); border:1px solid rgba(225,29,72,0.2); border-radius:12px; padding:1rem; text-align:center;">
                                    <div style="font-size:1.6rem; font-weight:900; color:#e11d48;" th:text="${totalUsers}">0</div>
                                    <div style="font-size:0.75rem; color:var(--text-secondary); font-weight:600;">ì „ì²´ íšŒì›</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div><!-- /container -->
</div>

<th:block layout:fragment="script">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <script th:inline="javascript">
        /*<![CDATA[*/
        const total    = /*[[${totalTournaments}]]*/ 0;
        const ongoing  = /*[[${ongoingTournaments}]]*/ 0;
        const ready    = Math.max(0, total - ongoing);
        const completed= Math.max(0, total - ongoing - Math.round(total * 0.3));
        const recruiting= Math.max(0, total - ongoing - completed - ready);

        const ctx = document.getElementById('tournamentChart');
        if (ctx && total > 0) {
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ì¤€ë¹„ì¤‘', 'ì ‘ìˆ˜ì¤‘', 'ì§„í–‰ì¤‘', 'ì¢…ë£Œ'],
                    datasets: [{
                        data: [ready, recruiting, ongoing, completed],
                        backgroundColor: ['#7c3aed','#22c55e','#f97316','#6b7280'],
                        borderWidth: 0, hoverOffset: 8
                    }]
                },
                options: {
                    cutout: '65%',
                    plugins: { legend: { display: false } },
                    animation: { duration: 1200, easing: 'easeInOutQuart' }
                }
            });
        } else if (ctx) {
            ctx.parentElement.innerHTML = '<div class="text-center text-muted py-4"><i class="bi bi-bar-chart" style="font-size:3rem; opacity:0.2;"></i><p class="mt-2 small">ëŒ€íšŒ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</p></div>';
        }
        /*]]>*/
    </script>
</th:block>
</body>
</html>
