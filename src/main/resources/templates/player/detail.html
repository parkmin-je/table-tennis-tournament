<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layout}">
<head>
    <title>선수 상세 정보</title>
</head>
<body>
<div layout:fragment="content">
    <div class="container mt-5">
        <!-- 성공/에러 메시지 -->
        <div th:if="${message}" class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="bi bi-check-circle-fill me-2"></i>
            <span th:text="${message}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            <span th:text="${error}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <div class="row">
            <div class="col-md-8 offset-md-2">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h3 class="mb-0">
                            <i class="bi bi-person-badge-fill me-2"></i>선수 상세 정보
                        </h3>
                        <div>
                            <a th:href="@{/player/edit/{id}(id=${player.id})}"
                               class="btn btn-warning btn-sm"
                               sec:authorize="hasRole('ADMIN')">
                                <i class="bi bi-pencil me-1"></i>수정
                            </a>
                            <a th:href="@{/player/list}"
                               class="btn btn-light btn-sm">
                                <i class="bi bi-list me-1"></i>목록
                            </a>
                        </div>
                    </div>
                    <div class="card-body">
                        <table class="table table-hover">
                            <tbody>
                            <tr>
                                <th style="width: 30%;">
                                    <i class="bi bi-person-fill me-2"></i>이름
                                </th>
                                <td>
                                    <strong th:text="${player.name}">홍길동</strong>
                                    <span class="badge ms-2"
                                          th:classappend="${player.gender == 'MALE' ? 'bg-primary' : 'bg-danger'}"
                                          th:text="${player.gender == 'MALE' ? '남' : '여'}">남</span>
                                </td>
                            </tr>
                            <tr>
                                <th>
                                    <i class="bi bi-calendar-fill me-2"></i>나이
                                </th>
                                <td th:text="${player.age != null ? player.age + '세' : '-'}">25세</td>
                            </tr>
                            <tr>
                                <th>
                                    <i class="bi bi-gender-ambiguous me-2"></i>성별
                                </th>
                                <td th:text="${player.gender != null ? (player.gender == 'MALE' ? '남성' : '여성') : '-'}">남성</td>
                            </tr>
                            <tr>
                                <th>
                                    <i class="bi bi-people-fill me-2"></i>소속 클럽
                                </th>
                                <td>
                                    <span th:if="${player.club != null}">
                                        <a th:href="@{|/club/detail/${player.club.id}|}"
                                           class="text-decoration-none"
                                           th:text="${player.club.name}">서울 탁구 클럽</a>
                                    </span>
                                    <span th:unless="${player.club != null}" class="text-muted">소속 없음</span>
                                </td>
                            </tr>
                            <tr>
                                <th>
                                    <i class="bi bi-trophy-fill me-2"></i>랭킹
                                </th>
                                <td>
                                    <span th:if="${player.ranking != null}"
                                          class="badge bg-success"
                                          th:text="${player.ranking + '위'}">10위</span>
                                    <span th:unless="${player.ranking != null}" class="text-muted">미정</span>
                                </td>
                            </tr>
                            <tr>
                                <th>
                                    <i class="bi bi-star-fill me-2"></i>포지션
                                </th>
                                <td th:text="${player.position != null ? player.position : '-'}">공격형</td>
                            </tr>
                            <tr>
                                <th>
                                    <i class="bi bi-telephone-fill me-2"></i>연락처
                                </th>
                                <td th:text="${player.contactInfo != null ? player.contactInfo : '-'}">010-1234-5678</td>
                            </tr>
                            <tr>
                                <th>
                                    <i class="bi bi-clock-fill me-2"></i>등록일
                                </th>
                                <td th:text="${#temporals.format(player.createdAt, 'yyyy-MM-dd HH:mm')}">2024-01-01 10:00</td>
                            </tr>
                            </tbody>
                        </table>

                        <!-- 삭제 버튼 (관리자만) -->
                        <div sec:authorize="hasRole('ADMIN')" class="mt-4">
                            <button type="button"
                                    class="btn btn-danger delete-btn"
                                    th:data-player-id="${player.id}"
                                    th:data-player-name="${player.name}">
                                <i class="bi bi-trash me-1"></i>선수 삭제
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 통계 카드 -->
                <div class="row g-3 mt-3">
                    <div class="col-md-4">
                        <div class="card text-center" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                            <div class="card-body py-4">
                                <i class="bi bi-trophy-fill" style="font-size: 2.5rem;"></i>
                                <h4 class="mt-3 mb-1" th:text="${player.ranking != null ? player.ranking : '-'}">0</h4>
                                <p class="mb-0">현재 랭킹</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-center" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
                            <div class="card-body py-4">
                                <i class="bi bi-calendar-fill" style="font-size: 2.5rem;"></i>
                                <h4 class="mt-3 mb-1" th:text="${player.age != null ? player.age : '-'}">0</h4>
                                <p class="mb-0">나이</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-center" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white;">
                            <div class="card-body py-4">
                                <i class="bi bi-people-fill" style="font-size: 2.5rem;"></i>
                                <h5 class="mt-3 mb-1 small" th:text="${player.club != null ? player.club.name : '-'}">-</h5>
                                <p class="mb-0">소속 클럽</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 삭제 확인 폼 -->
    <form id="deleteForm" method="post" style="display: none;">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
    </form>
</div>

<th:block layout:fragment="script">
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const deleteBtn = document.querySelector('.delete-btn');

            if (deleteBtn) {
                deleteBtn.addEventListener('click', function() {
                    const playerId = this.getAttribute('data-player-id');
                    const playerName = this.getAttribute('data-player-name');

                    if (confirm('정말로 "' + playerName + '" 선수를 삭제하시겠습니까?\n\n이 작업은 되돌릴 수 없습니다.')) {
                        const form = document.getElementById('deleteForm');
                        form.action = '/player/delete/' + playerId;
                        form.submit();
                    }
                });
            }
        });
    </script>
</th:block>
</body>
</html>
