<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>선수 목록</title>
    <th:block layout:fragment="css">
        <style>
            .player-card {
                background: white;
                border-radius: 12px;
                padding: 1.5rem;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                transition: all 0.3s ease;
                height: 100%;
                border: 2px solid transparent;
            }
            .player-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 8px 24px rgba(0,0,0,0.15);
                border-color: var(--bs-primary);
            }
            .player-avatar {
                width: 100px;
                height: 100px;
                background: linear-gradient(135deg, #0066cc, #00a8ff);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0 auto 1rem;
                font-size: 2.5rem;
                color: white;
                font-weight: bold;
            }
            .player-name {
                font-size: 1.5rem;
                font-weight: bold;
                color: #212529;
                margin-bottom: 0.5rem;
                text-align: center;
            }
            .player-info {
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
                margin: 1rem 0;
            }
            .info-item {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                font-size: 0.95rem;
                color: #6c757d;
            }
            .info-item i {
                color: var(--bs-primary);
                width: 20px;
            }
            .badge-ranking {
                background: linear-gradient(135deg, #ffc107, #ff9800);
                color: white;
                padding: 0.5rem 1rem;
                border-radius: 20px;
                font-weight: bold;
                display: inline-block;
                margin-bottom: 1rem;
            }
            .search-filter-bar {
                background: white;
                border-radius: 12px;
                padding: 1.5rem;
                margin-bottom: 2rem;
                box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            }
            .page-header {
                background: linear-gradient(135deg, #0066cc 0%, #0052a3 100%);
                color: white;
                padding: 3rem 0;
                margin: -2rem -2rem 2rem -2rem;
                border-radius: 0 0 20px 20px;
            }
            .stats-badge {
                background: rgba(255,255,255,0.2);
                padding: 0.5rem 1rem;
                border-radius: 8px;
                display: inline-block;
                margin-right: 1rem;
            }
            .action-buttons {
                display: flex;
                gap: 0.5rem;
                justify-content: center;
                margin-top: 1rem;
            }
        </style>
    </th:block>
</head>
<body>
<div layout:fragment="content" class="container-fluid">
    <!-- 페이지 헤더 -->
    <div class="page-header">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="mb-2">
                        <i class="bi bi-people-fill me-2"></i>선수 명단
                    </h1>
                    <p class="mb-0 opacity-75">안산시 탁구 협회 등록 선수</p>
                </div>
                <div>
                    <div class="stats-badge">
                        <i class="bi bi-person-check me-1"></i>
                        총 <strong th:text="${players.size()}">0</strong>명
                    </div>
                    <a sec:authorize="hasRole('ADMIN')"
                       th:href="@{/player/create}"
                       class="btn btn-light btn-lg">
                        <i class="bi bi-person-plus-fill me-2"></i>선수 등록
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="container my-4">
        <!-- 검색 및 필터 바 -->
        <div class="search-filter-bar">
            <div class="row g-3">
                <div class="col-md-6">
                    <div class="input-group input-group-lg">
                        <span class="input-group-text">
                            <i class="bi bi-search"></i>
                        </span>
                        <input type="text"
                               class="form-control"
                               id="searchInput"
                               placeholder="선수 이름 검색...">
                    </div>
                </div>
                <div class="col-md-3">
                    <select class="form-select form-select-lg" id="genderFilter">
                        <option value="">모든 성별</option>
                        <option value="남">남성</option>
                        <option value="여">여성</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select class="form-select form-select-lg" id="sortBy">
                        <option value="name">이름순</option>
                        <option value="ranking">랭킹순</option>
                        <option value="age">나이순</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- 선수가 없을 때 -->
        <div th:if="${#lists.isEmpty(players)}" class="text-center py-5">
            <i class="bi bi-person-x" style="font-size: 4rem; color: #dee2e6;"></i>
            <h3 class="mt-3 text-muted">등록된 선수가 없습니다</h3>
            <p class="text-muted">새로운 선수를 등록해주세요.</p>
            <a sec:authorize="hasRole('ADMIN')"
               th:href="@{/player/create}"
               class="btn btn-primary btn-lg mt-3">
                <i class="bi bi-person-plus-fill me-2"></i>첫 선수 등록하기
            </a>
        </div>

        <!-- 선수 카드 그리드 -->
        <div class="row g-4" id="playerGrid">
            <div class="col-lg-3 col-md-4 col-sm-6 player-item"
                 th:each="player : ${players}"
                 th:attr="data-name=${player.name}, data-gender=${player.gender}, data-ranking=${player.ranking}, data-age=${player.age}">
                <div class="player-card">
                    <!-- 프로필 아바타 -->
                    <div class="player-avatar">
                        <span th:text="${#strings.substring(player.name, 0, 1)}">선</span>
                    </div>

                    <!-- 랭킹 배지 -->
                    <div class="text-center" th:if="${player.ranking != null && player.ranking <= 10}">
                        <span class="badge-ranking">
                            <i class="bi bi-trophy-fill me-1"></i>
                            <span th:text="${player.ranking}">1</span>위
                        </span>
                    </div>

                    <!-- 선수 이름 -->
                    <h3 class="player-name" th:text="${player.name}">선수명</h3>

                    <!-- 선수 정보 -->
                    <div class="player-info">
                        <div class="info-item">
                            <i class="bi bi-person-badge"></i>
                            <span>ID: <strong th:text="${player.id}">1</strong></span>
                        </div>
                        <div class="info-item">
                            <i class="bi bi-calendar"></i>
                            <span th:text="${player.age} + '세'">25세</span>
                        </div>
                        <div class="info-item">
                            <i class="bi bi-gender-ambiguous"></i>
                            <span th:text="${player.gender == '남' ? '남성' : (player.gender == '여' ? '여성' : player.gender)}">성별</span>
                        </div>
                        <div class="info-item" th:if="${player.ranking != null}">
                            <i class="bi bi-award"></i>
                            <span>랭킹: <strong th:text="${player.ranking} + '위'">1위</strong></span>
                        </div>
                        <div class="info-item" th:if="${player.position != null}">
                            <i class="bi bi-bullseye"></i>
                            <span th:text="${player.position}">공격형</span>
                        </div>
                        <div class="info-item">
                            <i class="bi bi-building"></i>
                            <span th:text="${player.club != null ? player.club.name : '소속 없음'}">클럽명</span>
                        </div>
                    </div>

                    <!-- 관리 버튼 (관리자만) -->
                    <div sec:authorize="hasRole('ADMIN')" class="action-buttons">
                        <a th:href="@{|/player/edit/${player.id}|}"
                           class="btn btn-warning btn-sm flex-fill">
                            <i class="bi bi-pencil-fill me-1"></i>수정
                        </a>
                        <form th:action="@{|/player/delete/${player.id}|}"
                              method="post"
                              class="flex-fill"
                              onsubmit="return confirm('정말 이 선수를 삭제하시겠습니까?');">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                            <button type="submit" class="btn btn-danger btn-sm w-100">
                                <i class="bi bi-trash-fill me-1"></i>삭제
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<th:block layout:fragment="script">
    <script>
        // 검색 기능
        document.getElementById('searchInput').addEventListener('input', function(e) {
            filterPlayers();
        });

        // 성별 필터
        document.getElementById('genderFilter').addEventListener('change', function(e) {
            filterPlayers();
        });

        // 정렬
        document.getElementById('sortBy').addEventListener('change', function(e) {
            sortPlayers(e.target.value);
        });

        function filterPlayers() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const genderFilter = document.getElementById('genderFilter').value;
            const players = document.querySelectorAll('.player-item');

            players.forEach(player => {
                const name = player.getAttribute('data-name').toLowerCase();
                const gender = player.getAttribute('data-gender');

                const matchesSearch = name.includes(searchTerm);
                // ✅ DB에 "남", "여"로 저장되어 있으므로 이 값과 비교
                const matchesGender = !genderFilter || gender === genderFilter;

                if (matchesSearch && matchesGender) {
                    player.style.display = '';
                } else {
                    player.style.display = 'none';
                }
            });
        }

        function sortPlayers(sortBy) {
            const grid = document.getElementById('playerGrid');
            const players = Array.from(document.querySelectorAll('.player-item'));

            players.sort((a, b) => {
                if (sortBy === 'name') {
                    return a.getAttribute('data-name').localeCompare(b.getAttribute('data-name'));
                } else if (sortBy === 'ranking') {
                    const rankA = parseInt(a.getAttribute('data-ranking')) || 999;
                    const rankB = parseInt(b.getAttribute('data-ranking')) || 999;
                    return rankA - rankB;
                } else if (sortBy === 'age') {
                    return parseInt(a.getAttribute('data-age')) - parseInt(b.getAttribute('data-age'));
                }
            });

            players.forEach(player => grid.appendChild(player));
        }
    </script>
</th:block>
</body>
</html>